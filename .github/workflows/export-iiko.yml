# Ручная выгрузка данных из iiko в Neon и постобработка витрин.
# Запуск: Actions → Export iiko to Neon → Run workflow.

name: Export iiko to Neon

on:
  workflow_dispatch:

jobs:
  export:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Export from iiko to Neon
        env:
          IIKO_BASE_URL: ${{ secrets.IIKO_BASE_URL }}
          IIKO_LOGIN: ${{ secrets.IIKO_LOGIN }}
          IIKO_PASSWORD: ${{ secrets.IIKO_PASSWORD }}
          IIKO_PASSWORD_SHA1: ${{ secrets.IIKO_PASSWORD_SHA1 }}
          NEON_DATABASE_URL: ${{ secrets.NEON_DATABASE_URL }}
        run: python -m iiko.api.run_export

      - name: Run post-processing (refresh mart)
        env:
          NEON_DATABASE_URL: ${{ secrets.NEON_DATABASE_URL }}
        run: python neon/transforms/run_transforms.py
